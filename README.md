# OpenCV-Haar based training of Masked-Face-Dataset dataset for mask detection

The following content uses opencv_traincascade.exe and opencv_createsamples.exe, the trainers that come with opencv, to train the mask dataset.

## Environment preparation

Operating system: Windows

* opencv opencv should preferably be a lower version, e.g. OpenCV 3.4.1, as some of the files needed later (opencv_createsamples.exe and opencv_traincascade.exe) do not come with higher versions of opencv


## Data set preparation

The training set should consist of the following.
1. positive sample images: these contain only the object you are trying to detect, e.g. a mask.
2. negative sample images: these images can contain anything except the object you are trying to detect.

The data set needs to be divided into the following two parts:
nag & pos, which correspond to the negative sample image storage folder and the positive sample image folder in the root directory of the program.

* opencv_createsamples.exe: used to create multiple test samples. Depending on the list of parameters called, four functions are performed: create multiple training samples from a single image by distorting the deformation; create multiple test samples from a single image by distorting the deformation; create training samples from a list of images in the description file; and display the sample images in the VEC file.

* opencv_traincascade.exe: used for training of the Haar model.

General parameters.

-data <cascade_dir_name>
Directory name, if no training program exists it will be created to store the trained classifier.

-vec <vec_file_name>
The name of the vec file containing the positive samples (generated by the opencv_createsamples program).

-bg <background_file_name>
The background description file, i.e. the one containing the negative sample file names.

-numPos <number_of_positive_samples>
The number of positive samples to use for training each classifier level. This is set to 85% of the number of positive samples (which is a conservative value). The exact number depends on the number of levels in the cascade. This is because each stages increases the number of images to be classified.

-numNeg <number_of_negative_samples>
The number of negative samples used for training each classifier level, which can be greater than the number of images specified by -bg.

-numStages <number_of_stages>
The number of classifier stages to train.

-precalcValBufSize <precalculated_vals_buffer_size_in_Mb>
Buffer size in MB for storing pre-calculated feature values.

-precalcIdxBufSize <precalculated_idxs_buffer_size_in_Mb>
Buffer size to store pre-calculated feature indices in MB; the larger the memory, the shorter the training time.

-baseFormatSave
This parameter is only valid when using Haar features. If this parameter is specified, then the cascade classifier will be stored in the old format.
Cascade parameters.

-stageType <BOOST(default)>
The cascade (stage) parameter. Currently only the BOOST classifier is supported as a stage type.

-featureType <{HAAR(default), LBP}>
Type of feature: HAAR - Haar-like feature; LBP - Local texture pattern feature.

-w
-h
The size of the training sample (in pixels). Must be the same size as when the training samples were created (using the opencv_createsamples program).
Boosted classifier parameters.

-bt <{DAB, RAB, LB, GAB(default)}>
Type of Boosted classifier: DAB - Discrete AdaBoost, RAB - Real AdaBoost, LB - LogitBoost, GAB - Gentle AdaBoost.

-minHitRate <min_hit_rate>
The minimum detection rate desired for each level of the classifier. The total detection rate is approximately min_hit_rate^number_of_stages. the total detection rate is the detection recall of the whole cascade.

-maxFalseAlarmRate <max_false_alarm_rate>
The maximum false detection rate desired for each level of the classifier. The total false detection rate is approximately max_false_alarm_rate^number_of_stages. is the false detection rate for the entire cascade

-weightTrimRate <weight_trim_rate>
Specifies whether trimming should be used and its weight. A decent value is 0.95.

-maxDepth <max_depth_of_weak_tree>
The maximum depth of a weak classifier tree. An okay value is 1, for binomial trees (stumps).

-maxWeakCount <max_weak_tree_count>
The maximum number of weak classifiers in each stage. The boosted classifier (stage) will have so many weak trees (<=maxWeakCount), as needed to achieve the given -maxFalseAlarmRate.
Haar-like feature parameters.


-mode <BASIC (default) | CORE | ALL>
Selects the type of Haar features to be used in the training process. BASIC uses only top-right features, ALL uses all top-right features and 45 degree rotation features.





```bash
Author：Huang Jiaqi
Created: 2022-05-12
Last updated: 2022-05-16
Function：Target detection task for masks using the OpenCV-Haar model for the Masked-Face-Dataset dataset.
```
